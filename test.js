var finabel = require("./finabel");
var assert = require("assert");

const complain = console.error;
const print = console.log;
const crlf = () => print();

var tests = 0;
var errors = 0;

function report(useCase, expected, key, salt, rounds) {
  ++tests;
  useCase += " == " + expected + " :";
  try {
    assert.equal(finabel(key, salt, rounds), expected);
    print(useCase, "passed");
  } catch (error) {
    ++errors;
    complain(useCase, "FAILED");
  }
  crlf();
}

crlf();
print("****************** Unit Test ******************");
crlf();

report(
  "finabel()",
  "3d2f6407ca84583fa3bd275f603e18d536a142206fa77a0f01294087cc9247a70a308346ca28d393e035daa71a6f639802f56c4c8c5c45ac2d4867375c9c4302ea92e8cc97a13cd1ce437cf53a9530dc48fc9484d890ba3059f6c314e2c06f2a5a60b421996ea40ae3d96afbb9c8f8653ae3b1b8f0a643fd426edc401bc430844cf54e0c297129cb145764e496892a9a14bda9b5ddc1d4a9700e49b5613654edecb367b42dc97f43523621c37120183514b9740494b55666ffe7f3d24862765829a50a8dbd11cd9c0f60825bb3822bbf1b61002d400d8d4fd2df29e17c6b6722ccaae8ba18cb0b539704bacbab688a37a66b7aac8d9a8f0c6dc2468667f847d8c85f24"
);

report(
  "finabel('foobar')",
  "c9a9fd5bc1c80f0f994e963b8a2523aab9bc0c5af1f4a741b5a31fa2a7a93009bc390b2daa0879a4a552b828c68661d29bd451d7e068d0513cb922b9b67dabb3b1befd0ed3d05d985c832eaafa9f04df7f395104ef0e399046c2604265b60de64addcec50c19396bd14c523b10ce97b5f1d8869c1a23fff86aa7198b3042c13e3528c109cb1ff2ef460fda0ea1d638b60de4470ee59a37d3a8b4a730b45f052116a57c951c90efc667d20c89492f4a132070b009df3d5c6ba71cdad6044f531c57048bbf1682ab8ea732923fd034a8d7e7c303dddd322767bb9481fd2857772a7ff343a70b93e642b90d624297ba45d0f228b775a38557441033a3ac7bc9f891534",
  "foobar"
);

report(
  "finabel('foo', 'bar')",
  "910c4635fc9d223cec664ab656797435f6d50a044e99e85f9e7c0f884521b723ee3ced14e8f2546110e206fda00cf6dfdac5b05d0f22d080b0701419a392537484aa3e5e63c30f45c0295050b85f72f4695533850e9286d0585fd46e88b4931eb774ebcee12fce166ef2f190e6fa31927170509b962e14aed50ae2168615a0230bdfb0015e7b829258bb3319cfa0ea94b1897012ec408b7d26f7bbdc20b38de6383f263aaa2f04e477859e132f4ab527c3cfcf4e4b67364e02c90042207e38385fcaaa922ff7c5fa9132767fd5ae5a4f80851b0541a7046c8514e4981fd9663f4397fce22ad8081e5a6870f3b6b86dbeaa19078adc2b1ef23d14b",
  "foo",
  "bar"
);

report(
  "finabel('bar', 'foo')",
  "aca4610f3f0c7f2231d81e6d660ac58ee67b42814a6d324752f4c5de0f371b6ad298a4e8f51cf988d13d2ef5cb714d387aff9840b8a2147454e95fd4b4da174e5ae69837bc6b0fd96a5505562384d1023d44123a24e759c8513620aa8d67bee328bacfed34288979b739b5e52d8c95430281d226ee4dcfc75c491f08e9192036e5d3eaaafc9ab70bb3f60f6d6dd3c4ce448be6963c71de54a16711ddb57731f1b36c61e4d8625fb3c484cd6935b98b16eba5c4ae837b6de97c19db663d27f4d2da08a9889bcf2f0a6cf4e15d7b93d24cb556c72e6142277eb390f00ab3a5446bab3caa5992883c32d0a4d55cb7ccb07a0c87ee8eedd173bde",
  "bar",
  "foo"
);

report(
  "finabel('foo', 'bar', 8192)",
  "6517d3b27512088ad55cce24e4e133c4e55dc3ccfeed11edd8a27e1fce82bdb06adc333d90426c40873a5ed8c21464fb1616736ebb5f6e33de2a114de8ebcbb68c3feef5699d1b81a4af926e6c7f179cbe2d853a512e2d9f71ff0b99a1e7a54ea8d8b20d1a5425645a9429faf1527876ca16c7d5239d431dbdcf8aec024bef35668241da767f250d52af90c274e7c715ae813188da1d4a27dc0e1beedf4bc01f4668c4d7d5b80215fd56ea73e8b09c57c8a8fdcc7b02a9ddc03f3ba6335e3f549ad2d20221c797bf2523c8a1ebd599331448bcfa8caf70d20df8eb7edc3af33e27ff8ad940d581c583bba11d128817c7538dcf2f5e40ddaedbf63c5305ce7c6a8620aa",
  "foo",
  "bar",
  8192
);

report(
  "finabel('foo', 'bar', 4096)",
  "cbc88046fed0a9a790417d2daa12ac5f8cba675c1216020fb91c519daf00a760ed7a0776324125d5c15d3b97cb345fe0029b76c63b90286bd3e2ae222cf1a6cf92ba7c6e00890c24d595e7a7c5637ff5c6863b8cc5d888aff9aacbbe5ee09d91371b2972dec4200991ac236319276c41adb8631ac97fcd44c432e7db6cf72c5ce1146217ceb81d1aa2681f8bf0fa35d7471f8f829734f0801404f18d63d5e0c6b1d9ab85f40fe27037181171659325a49369ff0ef66e47c76adcdbbaa05250e58bc9d0ff2c51ddf75276cbd9ee4c3f4ff881149a81165d04ce595680eb1fa15eac226e14c4f78f4b5db496424395cc6499b804566bff66",
  "foo",
  "bar",
  4096
);

report(
  "finabel('ğŸ˜ƒğŸ§˜ğŸ»â€â™‚ï¸ğŸŒğŸğŸš—', 'ğŸ“ğŸ‰â™¥ï¸ğŸ')",
  "97be94af38f9768a1f9ea655b26608dc3f14f59b09cf964242f910f7d1c102bb3f86573398c4ccee33ccdbbaec99990d0c0d64177285657e8e20b6844f64d54aa0f98e863dba1df67e7501d1d3a564882300cdffc3338882cee08d8eca4891c354fca591a9daa62907e684ec9ed7a0f3328a119298f5ce9c4cc6be43d693faea6896b2106609de808d619358c136acd6b1104174a9fae7805b8fb2ed672275a799f10ae3ad49bbc61a5e6c16835fa634fabd3d7caa48edf061eec3c582e033aa7a18a296dcbb41d79f156357a6efea35940f8974a468132cece1400db5201b5aed7215d8ae907dea5a621e853e2fc78d30a0759bcc496b91038cf82134a06",
  "ğŸ˜ƒğŸ§˜ğŸ»â€â™‚ï¸ğŸŒğŸğŸš—",
  "ğŸ“ğŸ‰â™¥ï¸ğŸ"
);

const EXIT_SUCCESS = 0;
const EXIT_FAILURE = 1;

var code = undefined;

if (errors) {
  complain(" Passed", tests - errors, "of", tests, "tests.");
  code = EXIT_FAILURE;
} else {
  print(" All tests passed.");
  code = EXIT_SUCCESS;
}

crlf();
print("***********************************************");
crlf();

process.exit(code);
